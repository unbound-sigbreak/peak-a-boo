let a=null,t,u=null;window.onload=function(){var e=document.getElementById("close-modal"),o=document.getElementById("comments-refresh"),t=document.getElementById("comments-processed-refresh");const n=document.getElementById("show-parsed-comments"),s=document.getElementById("show-raw-llm-output"),m=document.getElementById("parsed-comments-debug-wrapper"),r=document.getElementById("raw-llm-debug-wrapper"),c=document.getElementById("llm-response-data"),d=document.getElementById("raw-llm-debug");m.style.display="none",r.style.display="none",e.onclick=()=>{window.close()},n.onclick=()=>{"none"===m.style.display||""===m.style.display?(m.style.display="block",n.innerText="Hide Parsed Comments"):(m.style.display="none",n.innerText="Show Parsed Comments")},s.onclick=()=>{"none"===r.style.display||""===r.style.display?(r.style.display="block",s.innerText="Hide raw LLM Output"):(r.style.display="none",s.innerText="Show Raw LLM Output")},o.onclick=()=>{const n=[];document.getElementById("comments-retrieved-state").innerText="Loading",document.getElementById("comments-parsed-state").innerText="No",document.getElementById("comments-processed-state").innerText="Outdated",document.getElementById("comments-processed-refresh").style.display="none",chrome.runtime.sendMessage({action:"fetchRedditUserData",username:a},t=>{if(t?.success){let o=null;try{o=JSON.parse(t.data)}catch(e){"object"==typeof t.data?o=t.data:n.push("Error parsing comment JSON data")}chrome.runtime.sendMessage({action:"sendRawCommentContentToModal",content:{username:a,o:o,t:n}}),chrome.runtime.sendMessage({action:"parseCommentsForLlm",o:o},e=>{chrome.runtime.sendMessage({action:"sendParsedCommentContentToModal",content:{username:a,m:e.comments,t:n}})})}else console.error("[Peak-A-Boo]: Error fetching user data",t?.error)})},t.onclick=()=>{document.getElementById("comments-processed-state").innerText="Loading",document.getElementById("comments-processed-refresh").style.display="none",c.innerText="Waiting for LLM...",chrome.storage.local.get(["llmResponsePath"],o=>{chrome.runtime.sendMessage({action:"performLlmApiCall",content:{username:a,m:u}},e=>{e?.success?(document.getElementById("comments-processed-refresh").style.display="block",e.data.error?(console.log("API call response",e.data),document.getElementById("comments-processed-state").innerText="Error",c.innerText=JSON.stringify(e.data,null,2)):(document.getElementById("comments-processed-state").innerText="Yes",c.innerText=((e,o)=>{var t;let n=e;for(t of o.split(".")){var s,m=t.match(/(\w+)\[(\d+)\]/);if(void 0===(n=m?(s=m[1],m=parseInt(m[2],10),n[s]?n[s][m]:void 0):n[t]))break}return n})(e.data,o.llmResponsePath),d.innerText=JSON.stringify(e.data,null,2))):(document.getElementById("comments-processed-state").innerText="Error",c.innerText=e.error)})})}},chrome.runtime.onMessage.addListener((e,o)=>e&&"SET_RAW_COMMENTS"===e.type?(t=JSON.stringify(e.content.o,null,2),a=e.content.username,document.getElementById("comments-processed-refresh").style.display="none",document.getElementById("comments-retrieved-state").innerText="Yes",document.getElementById("comments-parsed-state").innerText="Loading",!0):!(!e||"SET_PARSED_COMMENTS"!==e.type||(u=e.content.m,a=e.content.username,document.getElementById("comments-parsed-section").innerText="Comments Parsed: "+u.length,document.getElementById("parsed-comments-debug").innerText=JSON.stringify(u,null,2),1<u.length&&(document.getElementById("comments-processed-refresh").style.display="block",document.getElementById("comments-parsed-state").innerText="Yes"),0)));