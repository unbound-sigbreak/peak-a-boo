chrome.runtime.onMessage.addListener((e,o,t)=>{"llmButtonInjectRescan"===e.action&&(a(),e=n(),console.log(e))});const n=()=>{const a=[];if(window.location.href.includes("reddit.com/r/")){var e=document.querySelectorAll("div.flex.items-center.pr-xs.overflow-hidden");e.length||a.push("[Peak-A-Boo]: Could not find main divs");let n=0;e.forEach(e=>{var o=e.querySelector("div.flex.flex-row.items-center.overflow-hidden");if(o){o=o.querySelector("faceplate-tracker a");if(o){const t=o.innerText.trim();o=e.querySelector("shreddit-comment-badges");o&&((e=document.createElement("button")).innerText="LLM",e.className="peak-a-boo-llm-button",e.style.marginLeft="10px",e.onclick=()=>{r(t)},o.parentElement.insertBefore(e,o.nextSibling),n++)}else a.push("[Peak-A-Boo]: Could not find faceplate-tracker")}else a.push("[Peak-A-Boo]: Could not find nested div")}),a.push(`[Peak-A-Boo]: Buttons Injected: '${n}'`)}else a.push("[Peak-A-Boo]: Not on a Reddit page");return a},a=()=>{document.querySelectorAll(".peak-a-boo-llm-button").forEach(e=>e.remove())},r=n=>{const a=[];window.open(chrome.runtime.getURL("modal.html?username="+n),"Peak-A-Boo "+n,"width=1200,height=800");chrome.runtime.sendMessage({action:"fetchRedditUserData",username:n},t=>{if(t?.success){let o=null;try{o=JSON.parse(t.data)}catch(e){"object"==typeof t.data?o=t.data:a.push("Error parsing comment JSON data")}d(n,o,"rawComments"),chrome.runtime.sendMessage({action:"sendRawCommentContentToModal",content:{username:n,o:o,t:a}});chrome.runtime.sendMessage({action:"parseCommentsForLlm",o:o,m:-1},e=>{d(n,e.comments,"parsedForLlm"),chrome.runtime.sendMessage({action:"sendParsedCommentContentToModal",content:{username:n,i:e.comments,l:-1,u:e.totalProcessed,t:a}})})}else console.error("[Peak-A-Boo]: Error fetching user data",t?.error)})};function d(e,o,t){var n="redditUserData";let a=document.getElementById(n);a||((a=document.createElement("script")).id=n,a.type="application/json",a.textContent="{}",document.documentElement.appendChild(a));n=JSON.parse(a.textContent);n[e]||(n[e]={}),n[e][t]=o,a.textContent=JSON.stringify(n)}window.addEventListener("load",()=>{n()});